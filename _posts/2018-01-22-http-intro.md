---
layout: post
title: 与HTTP关系密切的协议：IP、TCP和DNS
date: 2018-01-22 11:19:40
tags: [IP, TCP, DNS]
categories: 计算机网络
mathjax: true
---

* content
{:toc}

本文对 *IP、TCP和DNS* 三个协议进行简要介绍。




## 负责传输的IP协议
按层次分，IP(Internet Protocol)网际协议位于网络层。

IP协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是IP地址和MAC地址（Media Access Control Address）。

IP地址指明了节点被分配到的地址，MAC地址是指网卡所属的固定地址。IP地址可以和MAC地址进行配对。IP地址可变换，但MAC地址基本不会更改。

### 凭借MAC地址进行通信
IP间的通信依赖MAC地址。在网络上，通信的双方在同一局域网（LAN）内的情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。而在进行中转时，会利用下一站中转设备的MAC地址。这时，会采用ARP协议（Address Resolution Protocol）。

### ARP协议详细介绍
ARP是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

> * 首先，每个主机都会在自己的ARP缓冲区中建立一个ARP列表，以表示IP地址和MAC地址之间的对应关系。
> * 当源主机要发送数据时，首先检查ARP列表中是否有对应IP地址的目的主机的MAC地址，如果有，则直接发送数据，如果没有，就向本网段的所有主机发送ARP数据包，该数据包包括的内容有：源主机IP地址，源主机MAC地址，目的主机的IP地址。
> * 当本网络的所有主机收到该ARP数据包时，首先检查数据包中的目的IP地址是否是自己的IP地址，如果不是，则忽略该数据包；如果是，则首先从数据包中取出源主机的IP和MAC地址写入到ARP列表中，如果已经存在，则覆盖，然后将自己的MAC地址写入ARP响应包中，告诉源主机自己是它想要找的MAC地址。
> * 源主机收到ARP响应包后。将目的主机的IP和MAC地址写入ARP列表，并利用此信息发送数据。如果源主机一直没有收到ARP响应数据包，表示ARP查询失败。

*广播发送ARP请求，单播发送ARP响应。*

## 确保可靠性的TCP协议
按层次分，TCP位于传输层，提供可靠的字节流服务。

所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。而可靠的传输服务是指，能够把数据准确可靠地传给对方。一言以蔽之，TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据最终是否送达到对方。

### 确保数据能到达目标
为了准确无误地将数据送达目标处，TCP采用了三次握手（three-way handshaking）策略。

发送端首先发送一个带SYN标志地数据包给对方。接收端收到后，回传一个带有SYN／ACK标志地数据包以示传达确认信息。最后，发送端再回传一个带ACK标志的数据包，代表“握手”结束。

若在握手过程中某个阶段莫名中断，TCP协议会再次以相同顺序发送相同的数据包。

![TCP三次握手](http://ouy59qaqh.bkt.clouddn.com/tcp_three-way_handshaking.jpg)

除了上述三次握手，TCP协议还有其他各种手段来保证通信的可靠性。

## 负责域名解析的DNS服务
DNS（Domain Name System）服务是和HTTP协议一样位于应用层的协议。它提供域名到IP地址之间的解析服务。

计算机既可以被赋予IP地址，也可以被赋予主机名和域名。比如www.hackr.jp。

用户通常使用主机名或域名来访问对方计算机，而不是直接通过IP地址访问。因为与IP地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。

但要让计算机去理解名称，相对而言就变得困难了。因为计算机更擅长处理一长串数字。

为了解决上述问题，DNS服务应运而生。DNS协议提供通过域名查找IP地址，或逆向从IP地址反差域名的服务。

![DNS示意图](http://ouy59qaqh.bkt.clouddn.com/DNS.jpg)

## 各种协议与HTTP协议的关系

通过下面这张图可以了解下IP协议、TCP协议和DNS服务在使用HTTP协议的通信过程中各自发挥了哪些作用。

![HTTP协议通信过程](http://ouy59qaqh.bkt.clouddn.com/HTTP_1.jpg)

参考：《图解HTTP》
